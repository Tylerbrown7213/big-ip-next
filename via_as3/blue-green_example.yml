{
  "class": "ADC",
  "controls": {
    "class": "Controls",
    "logLevel": "error"
  },
  "id": "blue-green-example-template",
  "label": "Blue Green Example Template",
  "remark": "",
  "schemaVersion": "3.43.0",
  "tenantjEZfJ914RSeKdZHgl8u5YbA": {
    "class": "Tenant",
    "test1": {
      "blue_pool": {
        "class": "Pool",
        "loadBalancingMode": "round-robin",
        "members": [
          {
            "servers": [
              {
                "address": "{{app_server1_ip}}",
                "name": "{{app_server1_ip}}"
              }
            ],
            "servicePort": {{app_server1_port}}
          }
        ],
        "monitors": [
          "http"
        ]
      },
      "blue_pool_service": {
        "class": "Service_Pool",
        "pool": "blue_pool"
      },
      "class": "Application",
      "green_pool": {
        "class": "Pool",
        "loadBalancingMode": "round-robin",
        "members": [
          {
            "servers": [
              {
                "address": "{{app_server2_ip}}",
                "name": "{{app_server2_ip}}"
              }
            ],
            "servicePort": {{app_server2_port}}
          }
        ],
        "monitors": [
          "http"
        ]
      },
      "green_pool_service": {
        "class": "Service_Pool",
        "pool": "green_pool"
      },
      "http_vs": {
        "class": "Service_HTTP",
        "iRules": [
          "test1_blue_green_iRule"
        ],
        "persistenceMethods": [],
        "pool": "blue_pool",
        "snat": "auto",
        "virtualAddresses": [
          "{{vip2}}"
        ],
        "virtualPort": {{vip_port1}}
      },
      "test1_blue_green_iRule": {
        "class": "iRule",
        "iRule": "when RULE_INIT { set static::ratio {{ratio}} }\n when CLIENT_ACCEPTED {\nlog local0. [TCP::client_port]\nset rand [expr {[TCP::client_port] % 100}]\nif { $rand > $static::ratio } {\n pool /app/tenantjEZfJ914RSeKdZHgl8u5YbA:test1/pool/tenantjEZfJ914RSeKdZHgl8u5YbA:test1:green_pool_service\n }\n}"
      }
    }
  }
}